<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>atef.config &mdash; atef  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=fd3f3429" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/docs-versions-menu.js?v=3d6a1aea"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            atef
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">ATEF API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases.html">Release History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../upcoming_changes.html">Upcoming Changes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/pcdshub/atef">Github Repository</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">atef</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">atef.config</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for atef.config</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Contains &quot;Configuration&quot; dataclasses for organizing ``Comparisons``.</span>
<span class="sd">Also contains &quot;Prepared&quot; variants of ``Comparison`` and ``Configuration`` classes,</span>
<span class="sd">which link ``Comparisons`` to specific identifiers and hold ``Result`` objects.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="p">(</span><span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Generator</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span>
                    <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">cast</span><span class="p">,</span> <span class="n">get_args</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">apischema</span>
<span class="kn">import</span> <span class="nn">happi</span>
<span class="kn">import</span> <span class="nn">ophyd</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">from</span> <span class="nn">ophyd.signal</span> <span class="kn">import</span> <span class="n">ConnectionTimeoutError</span>

<span class="kn">from</span> <span class="nn">atef.find_replace</span> <span class="kn">import</span> <span class="n">RegexFindReplace</span>
<span class="kn">from</span> <span class="nn">atef.result</span> <span class="kn">import</span> <span class="n">_summarize_result_severity</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">serialization</span><span class="p">,</span> <span class="n">tools</span><span class="p">,</span> <span class="n">util</span>
<span class="kn">from</span> <span class="nn">.cache</span> <span class="kn">import</span> <span class="n">DataCache</span>
<span class="kn">from</span> <span class="nn">.check</span> <span class="kn">import</span> <span class="n">Comparison</span>
<span class="kn">from</span> <span class="nn">.enums</span> <span class="kn">import</span> <span class="n">GroupResultMode</span><span class="p">,</span> <span class="n">Severity</span>
<span class="kn">from</span> <span class="nn">.exceptions</span> <span class="kn">import</span> <span class="n">PreparationError</span><span class="p">,</span> <span class="n">PreparedComparisonException</span>
<span class="kn">from</span> <span class="nn">.result</span> <span class="kn">import</span> <span class="n">Result</span><span class="p">,</span> <span class="n">incomplete_result</span>
<span class="kn">from</span> <span class="nn">.type_hints</span> <span class="kn">import</span> <span class="n">AnyPath</span>
<span class="kn">from</span> <span class="nn">.yaml_support</span> <span class="kn">import</span> <span class="n">init_yaml_support</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="Configuration">
<a class="viewcode-back" href="../../generated/generated/atef.config.Configuration.html#atef.config.Configuration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="nd">@serialization</span><span class="o">.</span><span class="n">as_tagged_union</span>
<span class="k">class</span> <span class="nc">Configuration</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Configuration base class for shared settings between all configurations.</span>

<span class="sd">    Subclasses of Comparison will be serialized as a tagged union.  This means</span>
<span class="sd">    that the subclass name will be used as an identifier for the generated</span>
<span class="sd">    serialized dictionary (and JSON object).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#: Name tied to this configuration.</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1">#: Description tied to this configuration.</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1">#: Tags tied to this configuration.</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="Configuration.children">
<a class="viewcode-back" href="../../generated/generated/atef.config.Configuration.html#atef.config.Configuration.children">[docs]</a>
    <span class="k">def</span> <span class="nf">children</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return children of this group, as a tree view might expect&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="Configuration.replace_comparison">
<a class="viewcode-back" href="../../generated/generated/atef.config.Configuration.html#atef.config.Configuration.replace_comparison">[docs]</a>
    <span class="k">def</span> <span class="nf">replace_comparison</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">old_comp</span><span class="p">:</span> <span class="n">Comparison</span><span class="p">,</span>
        <span class="n">new_comp</span><span class="p">:</span> <span class="n">Comparison</span><span class="p">,</span>
        <span class="n">comp_attrs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace ``old_comp`` with ``new_comp`` in this dataclass, wherever it is.</span>
<span class="sd">        Looks through ``shared``, then any of the attributes in ``comp_attrs``</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        old_comp : Comparison</span>
<span class="sd">            Comparison to be replaced</span>
<span class="sd">        new_comp : Comparison</span>
<span class="sd">            Comparison to replace ``old_comp`` with</span>
<span class="sd">        comp_attrs : Optional[List[str]], optional</span>
<span class="sd">            Attribute names in the dataclass to check, by default None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">comp_attrs</span> <span class="o">=</span> <span class="n">comp_attrs</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">comp_attrs</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;shared&quot;</span><span class="p">]):</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">util</span><span class="o">.</span><span class="n">replace_in_list</span><span class="p">(</span>
                <span class="n">old</span><span class="o">=</span><span class="n">old_comp</span><span class="p">,</span>
                <span class="n">new</span><span class="o">=</span><span class="n">new_comp</span><span class="p">,</span>
                <span class="n">item_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">shared</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">comp_attrs</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">comp_list</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">util</span><span class="o">.</span><span class="n">replace_in_list</span><span class="p">(</span>
                            <span class="n">old</span><span class="o">=</span><span class="n">old_comp</span><span class="p">,</span>
                            <span class="n">new</span><span class="o">=</span><span class="n">new_comp</span><span class="p">,</span>
                            <span class="n">item_list</span><span class="o">=</span><span class="n">comp_list</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">break</span></div>


<div class="viewcode-block" id="Configuration.move_comparison">
<a class="viewcode-back" href="../../generated/generated/atef.config.Configuration.html#atef.config.Configuration.move_comparison">[docs]</a>
    <span class="k">def</span> <span class="nf">move_comparison</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">comp</span><span class="p">:</span> <span class="n">Comparison</span><span class="p">,</span>
        <span class="n">new_attr</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">comp_attrs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">att</span><span class="p">)</span> <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="n">comp_attrs</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;shared&quot;</span><span class="p">]):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;cannot find a requested attr in dataclass&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># remove from all attrs</span>
        <span class="n">util</span><span class="o">.</span><span class="n">remove_by_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shared</span><span class="p">,</span> <span class="n">comp</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">comp_attrs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">comp_list</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">util</span><span class="o">.</span><span class="n">remove_by_id</span><span class="p">(</span><span class="n">comp_list</span><span class="p">,</span> <span class="n">comp</span><span class="p">)</span>

        <span class="c1"># place into new_attr</span>
        <span class="k">if</span> <span class="n">new_attr</span> <span class="o">==</span> <span class="s2">&quot;shared&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">comp_attrs</span><span class="p">:</span>
                <span class="n">attr_dict</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="p">{})</span>
                <span class="k">if</span> <span class="n">new_attr</span> <span class="ow">in</span> <span class="n">attr_dict</span><span class="p">:</span>
                    <span class="n">attr_dict</span><span class="p">[</span><span class="n">new_attr</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ConfigurationGroup">
<a class="viewcode-back" href="../../generated/generated/atef.config.ConfigurationGroup.html#atef.config.ConfigurationGroup">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">ConfigurationGroup</span><span class="p">(</span><span class="n">Configuration</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Configuration group.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#: Configurations underneath this group.</span>
    <span class="n">configs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Configuration</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="c1">#: Values that can be reused in comparisons underneath this group.</span>
    <span class="n">values</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="c1">#: Result mode.</span>
    <span class="n">mode</span><span class="p">:</span> <span class="n">GroupResultMode</span> <span class="o">=</span> <span class="n">GroupResultMode</span><span class="o">.</span><span class="n">all_</span>

<div class="viewcode-block" id="ConfigurationGroup.walk_configs">
<a class="viewcode-back" href="../../generated/generated/atef.config.ConfigurationGroup.html#atef.config.ConfigurationGroup.walk_configs">[docs]</a>
    <span class="k">def</span> <span class="nf">walk_configs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">AnyConfiguration</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">configs</span><span class="p">:</span>
            <span class="c1"># `config` is stored as Configuration due to the tagged union;</span>
            <span class="c1"># however we never yield Configuration instances, just subclasses</span>
            <span class="c1"># thereof:</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">AnyConfiguration</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">config</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">ConfigurationGroup</span><span class="p">):</span>
                <span class="k">yield from</span> <span class="n">config</span><span class="o">.</span><span class="n">walk_configs</span><span class="p">()</span></div>


<div class="viewcode-block" id="ConfigurationGroup.children">
<a class="viewcode-back" href="../../generated/generated/atef.config.ConfigurationGroup.html#atef.config.ConfigurationGroup.children">[docs]</a>
    <span class="k">def</span> <span class="nf">children</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Configuration</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return children of this group, as a tree view might expect&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">configs</span></div>
</div>



<div class="viewcode-block" id="DeviceConfiguration">
<a class="viewcode-back" href="../../generated/generated/atef.config.DeviceConfiguration.html#atef.config.DeviceConfiguration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">DeviceConfiguration</span><span class="p">(</span><span class="n">Configuration</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A configuration that is built to check one or more devices.</span>

<span class="sd">    Identifiers are by default assumed to be attribute (component) names of the</span>
<span class="sd">    devices.  Identifiers may refer to components on the device</span>
<span class="sd">    (``&quot;component&quot;`` would mean to access each device&#39;s ``.component``) or may</span>
<span class="sd">    refer to any level of sub-device components (``&quot;sub_device.component&quot;``</span>
<span class="sd">    would mean to access each device&#39;s ``.sub_device`` and that sub-device&#39;s</span>
<span class="sd">    ``.a`` component).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#: The device names.</span>
    <span class="n">devices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="c1">#: Device attribute name to comparison list.</span>
    <span class="n">by_attr</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Comparison</span><span class="p">]]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="c1">#: Comparisons to be run on *all* identifiers in the `by_attr` dictionary.</span>
    <span class="n">shared</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Comparison</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

<div class="viewcode-block" id="DeviceConfiguration.children">
<a class="viewcode-back" href="../../generated/generated/atef.config.DeviceConfiguration.html#atef.config.DeviceConfiguration.children">[docs]</a>
    <span class="k">def</span> <span class="nf">children</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Comparison</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return children of this group, as a tree view might expect&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">([</span><span class="n">comp</span> <span class="k">for</span> <span class="n">comp_list</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_attr</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">comp_list</span><span class="p">]</span>
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">shared</span><span class="p">)</span></div>


<div class="viewcode-block" id="DeviceConfiguration.replace_comparison">
<a class="viewcode-back" href="../../generated/generated/atef.config.DeviceConfiguration.html#atef.config.DeviceConfiguration.replace_comparison">[docs]</a>
    <span class="k">def</span> <span class="nf">replace_comparison</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">old_comp</span><span class="p">:</span> <span class="n">Comparison</span><span class="p">,</span>
        <span class="n">new_comp</span><span class="p">:</span> <span class="n">Comparison</span><span class="p">,</span>
        <span class="n">comp_attrs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace ``old_comp`` with ``new_comp`` in this dataclass, wherever it is.</span>
<span class="sd">        Looks through ``shared``, then any of the attributes in ``comp_attrs``</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        old_comp : Comparison</span>
<span class="sd">            Comparison to be replaced</span>
<span class="sd">        new_comp : Comparison</span>
<span class="sd">            Comparison to replace ``old_comp`` with</span>
<span class="sd">        comp_attrs : Optional[List[str]], optional</span>
<span class="sd">            Attribute names in the dataclass to check, by default [&#39;by_attr&#39;] if</span>
<span class="sd">            no value is provided</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">comp_attrs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">comp_attrs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;by_attr&#39;</span><span class="p">]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">replace_comparison</span><span class="p">(</span><span class="n">old_comp</span><span class="p">,</span> <span class="n">new_comp</span><span class="p">,</span> <span class="n">comp_attrs</span><span class="p">)</span></div>


<div class="viewcode-block" id="DeviceConfiguration.move_comparison">
<a class="viewcode-back" href="../../generated/generated/atef.config.DeviceConfiguration.html#atef.config.DeviceConfiguration.move_comparison">[docs]</a>
    <span class="k">def</span> <span class="nf">move_comparison</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">comp</span><span class="p">:</span> <span class="n">Comparison</span><span class="p">,</span>
        <span class="n">new_attr</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">comp_attrs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">move_comparison</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">new_attr</span><span class="p">,</span> <span class="n">comp_attrs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;by_attr&#39;</span><span class="p">])</span></div>
</div>



<div class="viewcode-block" id="PVConfiguration">
<a class="viewcode-back" href="../../generated/generated/atef.config.PVConfiguration.html#atef.config.PVConfiguration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">PVConfiguration</span><span class="p">(</span><span class="n">Configuration</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A configuration that is built to check live EPICS PVs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#: PV name to comparison list.</span>
    <span class="n">by_pv</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Comparison</span><span class="p">]]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="c1">#: Comparisons to be run on *all* PVs in the `by_pv` dictionary.</span>
    <span class="n">shared</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Comparison</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

<div class="viewcode-block" id="PVConfiguration.children">
<a class="viewcode-back" href="../../generated/generated/atef.config.PVConfiguration.html#atef.config.PVConfiguration.children">[docs]</a>
    <span class="k">def</span> <span class="nf">children</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Comparison</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return children of this group, as a tree view might expect&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">([</span><span class="n">comp</span> <span class="k">for</span> <span class="n">comp_list</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_pv</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">comp_list</span><span class="p">]</span>
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">shared</span><span class="p">)</span></div>


<div class="viewcode-block" id="PVConfiguration.replace_comparison">
<a class="viewcode-back" href="../../generated/generated/atef.config.PVConfiguration.html#atef.config.PVConfiguration.replace_comparison">[docs]</a>
    <span class="k">def</span> <span class="nf">replace_comparison</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">old_comp</span><span class="p">:</span> <span class="n">Comparison</span><span class="p">,</span>
        <span class="n">new_comp</span><span class="p">:</span> <span class="n">Comparison</span><span class="p">,</span>
        <span class="n">comp_attrs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace ``old_comp`` with ``new_comp`` in this dataclass, wherever it is.</span>
<span class="sd">        Looks through ``shared``, then any of the attributes in ``comp_attrs``</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        old_comp : Comparison</span>
<span class="sd">            Comparison to be replaced</span>
<span class="sd">        new_comp : Comparison</span>
<span class="sd">            Comparison to replace ``old_comp`` with</span>
<span class="sd">        comp_attrs : Optional[List[str]], optional</span>
<span class="sd">            Attribute names in the dataclass to check, by default [&#39;by_pv&#39;] if</span>
<span class="sd">            no value is provided</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">comp_attrs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">comp_attrs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;by_pv&#39;</span><span class="p">]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">replace_comparison</span><span class="p">(</span><span class="n">old_comp</span><span class="p">,</span> <span class="n">new_comp</span><span class="p">,</span> <span class="n">comp_attrs</span><span class="p">)</span></div>


<div class="viewcode-block" id="PVConfiguration.move_comparison">
<a class="viewcode-back" href="../../generated/generated/atef.config.PVConfiguration.html#atef.config.PVConfiguration.move_comparison">[docs]</a>
    <span class="k">def</span> <span class="nf">move_comparison</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">comp</span><span class="p">:</span> <span class="n">Comparison</span><span class="p">,</span>
        <span class="n">new_attr</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">comp_attrs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">move_comparison</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">new_attr</span><span class="p">,</span> <span class="n">comp_attrs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;by_pv&#39;</span><span class="p">])</span></div>
</div>



<div class="viewcode-block" id="ToolConfiguration">
<a class="viewcode-back" href="../../generated/generated/atef.config.ToolConfiguration.html#atef.config.ToolConfiguration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">ToolConfiguration</span><span class="p">(</span><span class="n">Configuration</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A configuration unrelated to PVs or Devices which verifies status via some</span>
<span class="sd">    tool.</span>

<span class="sd">    Comparisons can optionally be run on the tool&#39;s results.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#: The tool and its settings.  Subclasses such as &quot;Ping&quot; are expected</span>
    <span class="c1">#: here.</span>
    <span class="n">tool</span><span class="p">:</span> <span class="n">tools</span><span class="o">.</span><span class="n">Tool</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">tools</span><span class="o">.</span><span class="n">Ping</span><span class="p">)</span>
    <span class="c1">#: Result attribute name to comparison list.</span>
    <span class="n">by_attr</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Comparison</span><span class="p">]]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="c1">#: Comparisons to be run on *all* identifiers in the `by_attr` dictionary.</span>
    <span class="n">shared</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Comparison</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

<div class="viewcode-block" id="ToolConfiguration.children">
<a class="viewcode-back" href="../../generated/generated/atef.config.ToolConfiguration.html#atef.config.ToolConfiguration.children">[docs]</a>
    <span class="k">def</span> <span class="nf">children</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Comparison</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return children of this group, as a tree view might expect&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">([</span><span class="n">comp</span> <span class="k">for</span> <span class="n">comp_list</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_attr</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">comp_list</span><span class="p">]</span>
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">shared</span><span class="p">)</span></div>


<div class="viewcode-block" id="ToolConfiguration.replace_comparison">
<a class="viewcode-back" href="../../generated/generated/atef.config.ToolConfiguration.html#atef.config.ToolConfiguration.replace_comparison">[docs]</a>
    <span class="k">def</span> <span class="nf">replace_comparison</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">old_comp</span><span class="p">:</span> <span class="n">Comparison</span><span class="p">,</span>
        <span class="n">new_comp</span><span class="p">:</span> <span class="n">Comparison</span><span class="p">,</span>
        <span class="n">comp_attrs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace ``old_comp`` with ``new_comp`` in this dataclass, wherever it is.</span>
<span class="sd">        Looks through ``shared``, then any of the attributes in ``comp_attrs``</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        old_comp : Comparison</span>
<span class="sd">            Comparison to be replaced</span>
<span class="sd">        new_comp : Comparison</span>
<span class="sd">            Comparison to replace ``old_comp`` with</span>
<span class="sd">        comp_attrs : Optional[List[str]], optional</span>
<span class="sd">            Attribute names in the dataclass to check, by default [&#39;by_attr&#39;] if</span>
<span class="sd">            no value is provided</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">comp_attrs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">comp_attrs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;by_attr&#39;</span><span class="p">]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">replace_comparison</span><span class="p">(</span><span class="n">old_comp</span><span class="p">,</span> <span class="n">new_comp</span><span class="p">,</span> <span class="n">comp_attrs</span><span class="p">)</span></div>


<div class="viewcode-block" id="ToolConfiguration.move_comparison">
<a class="viewcode-back" href="../../generated/generated/atef.config.ToolConfiguration.html#atef.config.ToolConfiguration.move_comparison">[docs]</a>
    <span class="k">def</span> <span class="nf">move_comparison</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">comp</span><span class="p">:</span> <span class="n">Comparison</span><span class="p">,</span>
        <span class="n">new_attr</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">comp_attrs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">move_comparison</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">new_attr</span><span class="p">,</span> <span class="n">comp_attrs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;by_attr&#39;</span><span class="p">])</span></div>
</div>



<div class="viewcode-block" id="TemplateConfiguration">
<a class="viewcode-back" href="../../generated/generated/atef.config.TemplateConfiguration.html#atef.config.TemplateConfiguration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">TemplateConfiguration</span><span class="p">(</span><span class="n">Configuration</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Configuration for applying changes to a template file.</span>
<span class="sd">    Breaks the convention for Configuration by not directly having any</span>
<span class="sd">    comparisons, but the generated file will have comparisons</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Path to a valid ConfigurationFile</span>
    <span class="n">filename</span><span class="p">:</span> <span class="n">AnyPath</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="c1"># List of edits to be applied to ``file_path``</span>
    <span class="n">edits</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">RegexFindReplace</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span></div>



<span class="n">AnyConfiguration</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">PVConfiguration</span><span class="p">,</span>
    <span class="n">DeviceConfiguration</span><span class="p">,</span>
    <span class="n">ToolConfiguration</span><span class="p">,</span>
    <span class="n">ConfigurationGroup</span><span class="p">,</span>
    <span class="n">TemplateConfiguration</span><span class="p">,</span>
<span class="p">]</span>


<div class="viewcode-block" id="ConfigurationFile">
<a class="viewcode-back" href="../../generated/generated/atef.config.ConfigurationFile.html#atef.config.ConfigurationFile">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">ConfigurationFile</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A configuration file comprised of a number of devices/PV configurations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#: atef configuration file version information.</span>
    <span class="n">version</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">apischema</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">required</span><span class="p">)</span>
    <span class="c1">#: Top-level configuration group.</span>
    <span class="n">root</span><span class="p">:</span> <span class="n">ConfigurationGroup</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">ConfigurationGroup</span><span class="p">)</span>

<div class="viewcode-block" id="ConfigurationFile.walk_configs">
<a class="viewcode-back" href="../../generated/generated/atef.config.ConfigurationFile.html#atef.config.ConfigurationFile.walk_configs">[docs]</a>
    <span class="k">def</span> <span class="nf">walk_configs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">AnyConfiguration</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Walk configurations defined in this file.  This includes the &quot;root&quot;</span>
<span class="sd">        node.</span>

<span class="sd">        Yields</span>
<span class="sd">        ------</span>
<span class="sd">        AnyConfiguration</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
        <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">walk_configs</span><span class="p">()</span></div>


<div class="viewcode-block" id="ConfigurationFile.children">
<a class="viewcode-back" href="../../generated/generated/atef.config.ConfigurationFile.html#atef.config.ConfigurationFile.children">[docs]</a>
    <span class="k">def</span> <span class="nf">children</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ConfigurationGroup</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return children of this group, as a tree view might expect&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">]</span></div>


<div class="viewcode-block" id="ConfigurationFile.get_by_device">
<a class="viewcode-back" href="../../generated/generated/atef.config.ConfigurationFile.html#atef.config.ConfigurationFile.get_by_device">[docs]</a>
    <span class="k">def</span> <span class="nf">get_by_device</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">DeviceConfiguration</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all configurations that match the device name.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">walk_configs</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">DeviceConfiguration</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">devices</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">config</span></div>


<div class="viewcode-block" id="ConfigurationFile.get_by_pv">
<a class="viewcode-back" href="../../generated/generated/atef.config.ConfigurationFile.html#atef.config.ConfigurationFile.get_by_pv">[docs]</a>
    <span class="k">def</span> <span class="nf">get_by_pv</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">pvname</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">PVConfiguration</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all configurations + IdentifierAndComparison that match the PV name.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">walk_configs</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">PVConfiguration</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">pvname</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">by_pv</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">config</span></div>


<div class="viewcode-block" id="ConfigurationFile.get_by_tag">
<a class="viewcode-back" href="../../generated/generated/atef.config.ConfigurationFile.html#atef.config.ConfigurationFile.get_by_tag">[docs]</a>
    <span class="k">def</span> <span class="nf">get_by_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">tags</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Configuration</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all configurations that match the tag name.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tags</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">tag_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">walk_configs</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">tag_set</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">tags</span> <span class="ow">or</span> <span class="p">[])):</span>
                <span class="k">yield</span> <span class="n">config</span></div>


<div class="viewcode-block" id="ConfigurationFile.from_filename">
<a class="viewcode-back" href="../../generated/generated/atef.config.ConfigurationFile.html#atef.config.ConfigurationFile.from_filename">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_filename</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">AnyPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConfigurationFile</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load a configuration file from a file.  Dispatches based on file type&quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;.json&#39;</span><span class="p">:</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">ConfigurationFile</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">ConfigurationFile</span><span class="o">.</span><span class="n">from_yaml</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">config</span></div>


<div class="viewcode-block" id="ConfigurationFile.from_json">
<a class="viewcode-back" href="../../generated/generated/atef.config.ConfigurationFile.html#atef.config.ConfigurationFile.from_json">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">AnyPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConfigurationFile</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load a configuration file from JSON.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">serialized_config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">apischema</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">serialized_config</span><span class="p">)</span></div>


<div class="viewcode-block" id="ConfigurationFile.from_yaml">
<a class="viewcode-back" href="../../generated/generated/atef.config.ConfigurationFile.html#atef.config.ConfigurationFile.from_yaml">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_yaml</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">AnyPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConfigurationFile</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load a configuration file from yaml.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">serialized_config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">apischema</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">serialized_config</span><span class="p">)</span></div>


<div class="viewcode-block" id="ConfigurationFile.to_json">
<a class="viewcode-back" href="../../generated/generated/atef.config.ConfigurationFile.html#atef.config.ConfigurationFile.to_json">[docs]</a>
    <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dump this configuration file to a JSON-compatible dictionary.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">apischema</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">ConfigurationFile</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">exclude_defaults</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="ConfigurationFile.to_yaml">
<a class="viewcode-back" href="../../generated/generated/atef.config.ConfigurationFile.html#atef.config.ConfigurationFile.to_yaml">[docs]</a>
    <span class="k">def</span> <span class="nf">to_yaml</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dump this configuration file to yaml.&quot;&quot;&quot;</span>
        <span class="n">init_yaml_support</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_json</span><span class="p">())</span></div>


<div class="viewcode-block" id="ConfigurationFile.validate">
<a class="viewcode-back" href="../../generated/generated/atef.config.ConfigurationFile.html#atef.config.ConfigurationFile.validate">[docs]</a>
    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate the file is properly formed and can be prepared</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Tuple[bool, str]</span>
<span class="sd">            The verification success and reason (if verification failed)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">prep_file</span> <span class="o">=</span> <span class="n">PreparedFile</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">prep_failures</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">prep_file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">prepare_failures</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">prep_failures</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Failed to prepare </span><span class="si">{</span><span class="n">prep_failures</span><span class="si">}</span><span class="s1"> steps&#39;</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Unknown Error: </span><span class="si">{</span><span class="n">ex</span><span class="si">}</span><span class="s1">.&#39;</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">msg</span>

        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;&#39;</span></div>
</div>



<div class="viewcode-block" id="PreparedFile">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedFile.html#atef.config.PreparedFile">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">PreparedFile</span><span class="p">:</span>
    <span class="c1">#: The data cache to use for the preparation step.</span>
    <span class="n">cache</span><span class="p">:</span> <span class="n">DataCache</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1">#: The corresponding configuration file information.</span>
    <span class="n">file</span><span class="p">:</span> <span class="n">ConfigurationFile</span>
    <span class="c1">#: The happi client instance.</span>
    <span class="n">client</span><span class="p">:</span> <span class="n">happi</span><span class="o">.</span><span class="n">Client</span>
    <span class="c1">#: The comparisons defined in the top-level file.</span>
    <span class="n">root</span><span class="p">:</span> <span class="n">PreparedGroup</span>

<div class="viewcode-block" id="PreparedFile.from_config">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedFile.html#atef.config.PreparedFile.from_config">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_config</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">file</span><span class="p">:</span> <span class="n">ConfigurationFile</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">happi</span><span class="o">.</span><span class="n">Client</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cache</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataCache</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PreparedFile</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare a ConfigurationFile for running.</span>

<span class="sd">        If available, provide an instantiated happi Client and a data</span>
<span class="sd">        cache.  If unspecified, a configuration-derived happi Client will</span>
<span class="sd">        be instantiated and a new data cache will be utilized.</span>

<span class="sd">        The provided cache (or a new one) will be utilized for every</span>
<span class="sd">        configuration/comparison in the file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file : ConfigurationFile</span>
<span class="sd">            The configuration file instance.</span>
<span class="sd">        client : happi.Client, optional</span>
<span class="sd">            A happi Client instance.</span>
<span class="sd">        cache : DataCache, optional</span>
<span class="sd">            The data cache instance, if available.  If unspecified, a new data</span>
<span class="sd">            cache will be instantiated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">client</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">get_happi_client</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">cache</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cache</span> <span class="o">=</span> <span class="n">DataCache</span><span class="p">()</span>

        <span class="n">prepared_root</span> <span class="o">=</span> <span class="n">PreparedGroup</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span>
            <span class="n">file</span><span class="o">.</span><span class="n">root</span><span class="p">,</span>
            <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span>
            <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">prepared_file</span> <span class="o">=</span> <span class="n">PreparedFile</span><span class="p">(</span>
            <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">,</span>
            <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
            <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span>
            <span class="n">root</span><span class="o">=</span><span class="n">prepared_root</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">prepared_root</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">prepared_file</span>
        <span class="k">return</span> <span class="n">prepared_file</span></div>


<div class="viewcode-block" id="PreparedFile.fill_cache">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedFile.html#atef.config.PreparedFile.fill_cache">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">fill_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">asyncio</span><span class="o">.</span><span class="n">Task</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fill the DataCache.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        parallel : bool, optional</span>
<span class="sd">            By default, fill the cache in parallel with multiple asyncio tasks.</span>
<span class="sd">            If False, fill the cache sequentially.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[asyncio.Task] or None</span>
<span class="sd">            The tasks created when in parallel mode.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">parallel</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">prepared</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">walk_comparisons</span><span class="p">():</span>
                <span class="k">await</span> <span class="n">prepared</span><span class="o">.</span><span class="n">get_data_async</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">prepared</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">walk_comparisons</span><span class="p">():</span>
            <span class="n">task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">prepared</span><span class="o">.</span><span class="n">get_data_async</span><span class="p">())</span>
            <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">tasks</span></div>


<div class="viewcode-block" id="PreparedFile.walk_comparisons">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedFile.html#atef.config.PreparedFile.walk_comparisons">[docs]</a>
    <span class="k">def</span> <span class="nf">walk_comparisons</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">PreparedComparison</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Walk through the prepared comparisons.&quot;&quot;&quot;</span>
        <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">walk_comparisons</span><span class="p">()</span></div>


<div class="viewcode-block" id="PreparedFile.walk_groups">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedFile.html#atef.config.PreparedFile.walk_groups">[docs]</a>
    <span class="k">def</span> <span class="nf">walk_groups</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">AnyPreparedConfiguration</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Walk through the prepared groups.&quot;&quot;&quot;</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
        <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">walk_groups</span><span class="p">()</span></div>


<div class="viewcode-block" id="PreparedFile.children">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedFile.html#atef.config.PreparedFile.children">[docs]</a>
    <span class="k">def</span> <span class="nf">children</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">PreparedGroup</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return children of this group, as a tree view might expect&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">]</span></div>


<div class="viewcode-block" id="PreparedFile.compare">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedFile.html#atef.config.PreparedFile.compare">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run all comparisons and return a combined result.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">compare</span><span class="p">()</span></div>
</div>



<div class="viewcode-block" id="FailedConfiguration">
<a class="viewcode-back" href="../../generated/generated/atef.config.FailedConfiguration.html#atef.config.FailedConfiguration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">FailedConfiguration</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Configuration that failed to be prepared for running.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#: The data cache to use for the preparation step.</span>
    <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PreparedGroup</span><span class="p">]</span>
    <span class="c1">#: Configuration instance.</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">AnyConfiguration</span>
    <span class="c1">#: The result with a severity.</span>
    <span class="n">result</span><span class="p">:</span> <span class="n">Result</span>
    <span class="c1">#: Exception that was caught, if available.</span>
    <span class="n">exception</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="PreparedConfiguration">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedConfiguration.html#atef.config.PreparedConfiguration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">PreparedConfiguration</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for a Configuration that has been prepared to run.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#: The data cache to use for the preparation step.</span>
    <span class="n">cache</span><span class="p">:</span> <span class="n">DataCache</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1">#: The hierarchical parent of this step.</span>
    <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PreparedGroup</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1">#: The comparisons to be run on the given devices.</span>
    <span class="n">comparisons</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">PreparedSignalComparison</span><span class="p">,</span> <span class="n">PreparedToolComparison</span><span class="p">]]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span>
    <span class="p">)</span>
    <span class="c1">#: The comparisons that failed to be prepared.</span>
    <span class="n">prepare_failures</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PreparedComparisonException</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="c1">#: The result of all comparisons.</span>
    <span class="n">combined_result</span><span class="p">:</span> <span class="n">Result</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">incomplete_result</span><span class="p">)</span>

<div class="viewcode-block" id="PreparedConfiguration.from_config">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedConfiguration.html#atef.config.PreparedConfiguration.from_config">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_config</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">config</span><span class="p">:</span> <span class="n">AnyConfiguration</span><span class="p">,</span>
        <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PreparedGroup</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">happi</span><span class="o">.</span><span class="n">Client</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cache</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataCache</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span>
        <span class="n">PreparedPVConfiguration</span><span class="p">,</span>
        <span class="n">PreparedDeviceConfiguration</span><span class="p">,</span>
        <span class="n">PreparedToolConfiguration</span><span class="p">,</span>
        <span class="n">PreparedGroup</span><span class="p">,</span>
        <span class="n">PreparedTemplateConfiguration</span><span class="p">,</span>
        <span class="n">FailedConfiguration</span><span class="p">,</span>
    <span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare a Configuration for running.</span>

<span class="sd">        If available, provide an instantiated happi Client and a data</span>
<span class="sd">        cache.  If unspecified, a configuration-derived happi Client will</span>
<span class="sd">        be instantiated and a new data cache will be utilized.</span>

<span class="sd">        It is recommended to share a data cache on a per-configuration file</span>
<span class="sd">        basis.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        config : {PV,Device,Tool}Configuration or ConfigurationGroup</span>
<span class="sd">            The configuration.</span>
<span class="sd">        client : happi.Client, optional</span>
<span class="sd">            A happi Client instance.</span>
<span class="sd">        cache : DataCache, optional</span>
<span class="sd">            The data cache instance, if available.  If unspecified, a new data</span>
<span class="sd">            cache will be instantiated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cache</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cache</span> <span class="o">=</span> <span class="n">DataCache</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">PVConfiguration</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">PreparedPVConfiguration</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span>
                    <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
                    <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
                    <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">ToolConfiguration</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">PreparedToolConfiguration</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span>
                    <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
                    <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
                    <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">DeviceConfiguration</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">PreparedDeviceConfiguration</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span>
                    <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
                    <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
                    <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span>
                    <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">ConfigurationGroup</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">PreparedGroup</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span>
                    <span class="n">config</span><span class="p">,</span>
                    <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
                    <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span>
                    <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">TemplateConfiguration</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">PreparedTemplateConfiguration</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span>
                    <span class="n">config</span><span class="p">,</span>
                    <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
                    <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span>
                    <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Configuration type unsupported: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">PreparedComparisonException</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">FailedConfiguration</span><span class="p">(</span>
                <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
                <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
                <span class="n">exception</span><span class="o">=</span><span class="n">ex</span><span class="p">,</span>
                <span class="n">result</span><span class="o">=</span><span class="n">Result</span><span class="p">(</span>
                    <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">internal_error</span><span class="p">,</span>
                    <span class="n">reason</span><span class="o">=</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Failed to instantiate configuration: </span><span class="si">{</span><span class="n">ex</span><span class="si">}</span><span class="s2">. &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;Configuration is: </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">description</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">!r}</span><span class="s2">)&quot;</span>
                    <span class="p">),</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">FailedConfiguration</span><span class="p">(</span>
                <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
                <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
                <span class="n">exception</span><span class="o">=</span><span class="n">ex</span><span class="p">,</span>
                <span class="n">result</span><span class="o">=</span><span class="n">Result</span><span class="p">(</span>
                    <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">internal_error</span><span class="p">,</span>
                    <span class="n">reason</span><span class="o">=</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Failed to instantiate configuration: </span><span class="si">{</span><span class="n">ex</span><span class="si">}</span><span class="s2">. &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;Configuration is: </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">description</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">!r}</span><span class="s2">)&quot;</span>
                    <span class="p">),</span>
                <span class="p">),</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="PreparedConfiguration.walk_comparisons">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedConfiguration.html#atef.config.PreparedConfiguration.walk_comparisons">[docs]</a>
    <span class="k">def</span> <span class="nf">walk_comparisons</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">PreparedComparison</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Walk through the prepared comparisons.&quot;&quot;&quot;</span>
        <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">comparisons</span></div>


<div class="viewcode-block" id="PreparedConfiguration.compare">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedConfiguration.html#atef.config.PreparedConfiguration.compare">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run all comparisons and return a combined result.&quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">comparisons</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">PreparedComparison</span><span class="p">):</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">await</span> <span class="n">config</span><span class="o">.</span><span class="n">compare</span><span class="p">())</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_failures</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span>
                <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">error</span><span class="p">,</span>
                <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;At least one configuration failed to initialize&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">severity</span> <span class="o">=</span> <span class="n">_summarize_result_severity</span><span class="p">(</span><span class="n">GroupResultMode</span><span class="o">.</span><span class="n">all_</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span><span class="n">severity</span><span class="o">=</span><span class="n">severity</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">combined_result</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">result</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">result</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Re-compute the combined result and return it&quot;&quot;&quot;</span>
        <span class="c1"># read results without running steps</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">comparisons</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">result</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_failures</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span>
                <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">error</span><span class="p">,</span>
                <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;At least one configuration failed to initialize&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">severity</span> <span class="o">=</span> <span class="n">_summarize_result_severity</span><span class="p">(</span><span class="n">GroupResultMode</span><span class="o">.</span><span class="n">all_</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span><span class="n">severity</span><span class="o">=</span><span class="n">severity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">combined_result</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">result</span></div>



<div class="viewcode-block" id="PreparedGroup">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedGroup.html#atef.config.PreparedGroup">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">PreparedGroup</span><span class="p">(</span><span class="n">PreparedConfiguration</span><span class="p">):</span>
    <span class="c1">#: The corresponding group from the configuration file.</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">ConfigurationGroup</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">ConfigurationGroup</span><span class="p">)</span>
    <span class="c1">#: The hierarhical parent of this group.  If this is the root group,</span>
    <span class="c1">#: &#39;parent&#39; may be a PreparedFile.</span>
    <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">PreparedGroup</span><span class="p">,</span> <span class="n">PreparedFile</span><span class="p">]]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1">#: The configs defined in the group.</span>
    <span class="n">configs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AnyPreparedConfiguration</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="c1">#: The configs that failed to prepare.</span>
    <span class="n">prepare_failures</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FailedConfiguration</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

<div class="viewcode-block" id="PreparedGroup.get_value_by_name">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedGroup.html#atef.config.PreparedGroup.get_value_by_name">[docs]</a>
    <span class="k">def</span> <span class="nf">get_value_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a value defined in this group or in any ancestor.  The first found</span>
<span class="sd">        is returned.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The key name for the ``variables`` dictionary.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Any</span>
<span class="sd">            Value defined for the given key.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        KeyError</span>
<span class="sd">            If the key is not defined on this group or any ancestor group.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">PreparedGroup</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">get_value_by_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;No value defined for key: </span><span class="si">{key}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="PreparedGroup.from_config">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedGroup.html#atef.config.PreparedGroup.from_config">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_config</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">group</span><span class="p">:</span> <span class="n">ConfigurationGroup</span><span class="p">,</span>
        <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">PreparedGroup</span><span class="p">,</span> <span class="n">PreparedFile</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">happi</span><span class="o">.</span><span class="n">Client</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cache</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataCache</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PreparedGroup</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare a ConfigurationGroup for running.</span>

<span class="sd">        If available, provide an instantiated happi Client and a data</span>
<span class="sd">        cache.  If unspecified, a configuration-derived happi Client will</span>
<span class="sd">        be instantiated and a new data cache will be utilized.</span>

<span class="sd">        The provided cache (or a new one) will be utilized for every</span>
<span class="sd">        configuration/comparison in the file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        group : ConfigurationGroup</span>
<span class="sd">            The configuration group instance.</span>
<span class="sd">        parent : PreparedGroup or PreparedFile, optional</span>
<span class="sd">            The parent instance of the group.  If this is the root</span>
<span class="sd">            configuration, the parent may be a PreparedFile.</span>
<span class="sd">        client : happi.Client, optional</span>
<span class="sd">            A happi Client instance.</span>
<span class="sd">        cache : DataCache, optional</span>
<span class="sd">            The data cache instance, if available.  If unspecified, a new data</span>
<span class="sd">            cache will be instantiated.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">client</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">get_happi_client</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">cache</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cache</span> <span class="o">=</span> <span class="n">DataCache</span><span class="p">()</span>

        <span class="n">prepared</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
            <span class="n">config</span><span class="o">=</span><span class="n">group</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
            <span class="n">configs</span><span class="o">=</span><span class="p">[],</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">config</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">configs</span><span class="p">:</span>
            <span class="n">prepared_conf</span> <span class="o">=</span> <span class="n">PreparedConfiguration</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span>
                <span class="n">config</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="n">AnyConfiguration</span><span class="p">,</span> <span class="n">config</span><span class="p">),</span>
                <span class="n">parent</span><span class="o">=</span><span class="n">prepared</span><span class="p">,</span>
                <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span>
                <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prepared_conf</span><span class="p">,</span> <span class="n">FailedConfiguration</span><span class="p">):</span>
                <span class="n">prepared</span><span class="o">.</span><span class="n">prepare_failures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prepared_conf</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">prepared</span><span class="o">.</span><span class="n">configs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prepared_conf</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">prepared</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">subgroups</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">PreparedGroup</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Direct descendent subgroups in this group.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[PreparedGroup]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">config</span>
            <span class="k">for</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">configs</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">PreparedGroup</span><span class="p">)</span>
        <span class="p">]</span>

<div class="viewcode-block" id="PreparedGroup.walk_groups">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedGroup.html#atef.config.PreparedGroup.walk_groups">[docs]</a>
    <span class="k">def</span> <span class="nf">walk_groups</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">AnyPreparedConfiguration</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Walk through the prepared groups.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">configs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">get_args</span><span class="p">(</span><span class="n">AnyPreparedConfiguration</span><span class="p">)):</span>
                <span class="k">yield</span> <span class="n">config</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">PreparedGroup</span><span class="p">):</span>
                    <span class="k">yield from</span> <span class="n">config</span><span class="o">.</span><span class="n">walk_groups</span><span class="p">()</span></div>


<div class="viewcode-block" id="PreparedGroup.walk_comparisons">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedGroup.html#atef.config.PreparedGroup.walk_comparisons">[docs]</a>
    <span class="k">def</span> <span class="nf">walk_comparisons</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">PreparedComparison</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Walk through the prepared comparisons.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">configs</span><span class="p">:</span>
            <span class="k">yield from</span> <span class="n">config</span><span class="o">.</span><span class="n">walk_comparisons</span><span class="p">()</span></div>


<div class="viewcode-block" id="PreparedGroup.compare">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedGroup.html#atef.config.PreparedGroup.compare">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run all comparisons and return a combined result.&quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">configs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">PreparedConfiguration</span><span class="p">):</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">await</span> <span class="n">config</span><span class="o">.</span><span class="n">compare</span><span class="p">())</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_failures</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span>
                <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">error</span><span class="p">,</span>
                <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;At least one configuration failed to initialize&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">severity</span> <span class="o">=</span> <span class="n">_summarize_result_severity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span>
                <span class="n">severity</span><span class="o">=</span><span class="n">severity</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">combined_result</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">result</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">result</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Re-compute the combined result and return it&quot;&quot;&quot;</span>
        <span class="c1"># read results without running steps</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">configs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">PreparedConfiguration</span><span class="p">):</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">result</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_failures</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span>
                <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">error</span><span class="p">,</span>
                <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;At least one configuration failed to initialize&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">severity</span> <span class="o">=</span> <span class="n">_summarize_result_severity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span>
                <span class="n">severity</span><span class="o">=</span><span class="n">severity</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">combined_result</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">result</span></div>



<div class="viewcode-block" id="PreparedDeviceConfiguration">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedDeviceConfiguration.html#atef.config.PreparedDeviceConfiguration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">PreparedDeviceConfiguration</span><span class="p">(</span><span class="n">PreparedConfiguration</span><span class="p">):</span>
    <span class="c1">#: The configuration settings.</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">DeviceConfiguration</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">DeviceConfiguration</span><span class="p">)</span>
    <span class="c1">#: The device the comparisons apply to.</span>
    <span class="n">devices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ophyd</span><span class="o">.</span><span class="n">Device</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="c1">#: The comparisons to be run on the given devices.</span>
    <span class="n">comparisons</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PreparedSignalComparison</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="c1">#: The comparisons that failed to be prepared.</span>
    <span class="n">prepare_failures</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PreparedComparisonException</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

<div class="viewcode-block" id="PreparedDeviceConfiguration.from_device">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedDeviceConfiguration.html#atef.config.PreparedDeviceConfiguration.from_device">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_device</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">device</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ophyd</span><span class="o">.</span><span class="n">Device</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">ophyd</span><span class="o">.</span><span class="n">Device</span><span class="p">]],</span>
        <span class="n">by_attr</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Comparison</span><span class="p">]],</span>
        <span class="n">shared</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Comparison</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PreparedGroup</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cache</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataCache</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">happi</span><span class="o">.</span><span class="n">Client</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PreparedDeviceConfiguration</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a PreparedDeviceConfiguration given a device and some checks.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        device : Union[ophyd.Device, Sequence[ophyd.Device]]</span>
<span class="sd">            The device or devices to check.</span>
<span class="sd">        by_attr : Dict[str, List[Comparison]]</span>
<span class="sd">            Device attribute name to comparison list.</span>
<span class="sd">        shared : List[Comparison], optional</span>
<span class="sd">            Comparisons to be run on *all* signals identified in the `by_attr`</span>
<span class="sd">            dictionary.</span>
<span class="sd">        parent : PreparedGroup, optional</span>
<span class="sd">            The parent group, if applicable.</span>
<span class="sd">        cache : DataCache, optional</span>
<span class="sd">            The data cache instance, if available.  If unspecified, a new data</span>
<span class="sd">            cache will be instantiated.</span>
<span class="sd">        client : happi.Client, optional</span>
<span class="sd">            A happi Client, if available.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        PreparedDeviceConfiguration</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
            <span class="n">devices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">devices</span> <span class="o">=</span> <span class="p">[</span><span class="n">device</span><span class="p">]</span>

        <span class="n">config</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span>
            <span class="n">DeviceConfiguration</span><span class="p">(</span>
                <span class="n">devices</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">by_attr</span><span class="o">=</span><span class="n">by_attr</span><span class="p">,</span>
                <span class="n">shared</span><span class="o">=</span><span class="n">shared</span> <span class="ow">or</span> <span class="p">[],</span>
            <span class="p">),</span>
            <span class="n">additional_devices</span><span class="o">=</span><span class="n">devices</span><span class="p">,</span>
            <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
            <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">PreparedDeviceConfiguration</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span></div>


<div class="viewcode-block" id="PreparedDeviceConfiguration.from_config">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedDeviceConfiguration.html#atef.config.PreparedDeviceConfiguration.from_config">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_config</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">config</span><span class="p">:</span> <span class="n">DeviceConfiguration</span><span class="p">,</span>
        <span class="n">client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">happi</span><span class="o">.</span><span class="n">Client</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PreparedGroup</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cache</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataCache</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">additional_devices</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">ophyd</span><span class="o">.</span><span class="n">Device</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PreparedDeviceConfiguration</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare a DeviceConfiguration for running comparisons.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        config : DeviceConfiguration</span>
<span class="sd">            The configuration to prepare.</span>
<span class="sd">        parent : PreparedGroup, optional</span>
<span class="sd">            The parent group, if applicable.</span>
<span class="sd">        cache : DataCache, optional</span>
<span class="sd">            The data cache instance, if available.  If unspecified, a new data</span>
<span class="sd">            cache will be instantiated.</span>
<span class="sd">        client : happi.Client, optional</span>
<span class="sd">            A happi Client, if available.</span>
<span class="sd">        additional_devices : List[ophyd.Device], optional</span>
<span class="sd">            Additional devices (aside from those in the DeviceConfiguration)</span>
<span class="sd">            to add to the PreparedDeviceConfiguration list.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        FailedConfiguration or PreparedDeviceConfiguration</span>
<span class="sd">            If one or more devices is unavailable, a FailedConfiguration</span>
<span class="sd">            instance will be returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">DeviceConfiguration</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected configuration type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">client</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">get_happi_client</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">cache</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cache</span> <span class="o">=</span> <span class="n">DataCache</span><span class="p">()</span>

        <span class="n">devices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">additional_devices</span> <span class="ow">or</span> <span class="p">[])</span>
        <span class="k">for</span> <span class="n">dev_name</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">devices</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">devices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">get_happi_device_by_name</span><span class="p">(</span><span class="n">dev_name</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PreparedComparisonException</span><span class="p">(</span>
                    <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Failed to load happi device: </span><span class="si">{</span><span class="n">dev_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">prepared</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
                    <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
                    <span class="n">identifier</span><span class="o">=</span><span class="n">dev_name</span><span class="p">,</span>
                    <span class="n">exception</span><span class="o">=</span><span class="n">ex</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="n">prepared_comparisons</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">prepare_failures</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">shared</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">shared</span> <span class="ow">or</span> <span class="p">[]</span>

        <span class="n">prepared</span> <span class="o">=</span> <span class="n">PreparedDeviceConfiguration</span><span class="p">(</span>
            <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
            <span class="n">devices</span><span class="o">=</span><span class="n">devices</span><span class="p">,</span>
            <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
            <span class="n">comparisons</span><span class="o">=</span><span class="n">prepared_comparisons</span><span class="p">,</span>
            <span class="n">prepare_failures</span><span class="o">=</span><span class="n">prepare_failures</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">comparisons</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">by_attr</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">comparison</span> <span class="ow">in</span> <span class="n">comparisons</span> <span class="o">+</span> <span class="n">shared</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">prepared_comparisons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">PreparedSignalComparison</span><span class="o">.</span><span class="n">from_device</span><span class="p">(</span>
                                <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
                                <span class="n">attr</span><span class="o">=</span><span class="n">attr</span><span class="p">,</span>
                                <span class="n">comparison</span><span class="o">=</span><span class="n">comparison</span><span class="p">,</span>
                                <span class="n">parent</span><span class="o">=</span><span class="n">prepared</span><span class="p">,</span>
                                <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                        <span class="n">prepare_failures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">prepared</span></div>
</div>



<div class="viewcode-block" id="PreparedPVConfiguration">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedPVConfiguration.html#atef.config.PreparedPVConfiguration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">PreparedPVConfiguration</span><span class="p">(</span><span class="n">PreparedConfiguration</span><span class="p">):</span>
    <span class="c1">#: The configuration settings.</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">PVConfiguration</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">PVConfiguration</span><span class="p">)</span>
    <span class="c1">#: The comparisons to be run on the given devices.</span>
    <span class="n">comparisons</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PreparedSignalComparison</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="c1">#: The comparisons to be run on the given devices.</span>
    <span class="n">prepare_failures</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PreparedComparisonException</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

<div class="viewcode-block" id="PreparedPVConfiguration.from_pvs">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedPVConfiguration.html#atef.config.PreparedPVConfiguration.from_pvs">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_pvs</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">by_pv</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Comparison</span><span class="p">]],</span>
        <span class="n">shared</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Comparison</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PreparedGroup</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cache</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataCache</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PreparedPVConfiguration</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ready a set of PV checks without requiring an existing PVConfiguration.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        by_pv : Dict[str, List[Comparison]]</span>
<span class="sd">            PV name to comparison list.</span>
<span class="sd">        shared : list of Comparison, optional</span>
<span class="sd">            Comparisons to be run on *all* PVs in the `by_pv` dictionary.</span>
<span class="sd">        parent : PreparedGroup, optional</span>
<span class="sd">            The parent group.</span>
<span class="sd">        cache : DataCache, optional</span>
<span class="sd">            The data cache instance, if available.  If unspecified, a new data</span>
<span class="sd">            cache will be instantiated.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        PreparedPVConfiguration</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">config</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span>
            <span class="n">PVConfiguration</span><span class="p">(</span>
                <span class="n">by_pv</span><span class="o">=</span><span class="n">by_pv</span><span class="p">,</span>
                <span class="n">shared</span><span class="o">=</span><span class="n">shared</span> <span class="ow">or</span> <span class="p">[],</span>
            <span class="p">),</span>
            <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">PreparedPVConfiguration</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span></div>


<div class="viewcode-block" id="PreparedPVConfiguration.from_config">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedPVConfiguration.html#atef.config.PreparedPVConfiguration.from_config">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_config</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">config</span><span class="p">:</span> <span class="n">PVConfiguration</span><span class="p">,</span>
        <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PreparedGroup</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cache</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataCache</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PreparedPVConfiguration</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare a PVConfiguration for running.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        config : PVConfiguration</span>
<span class="sd">            The configuration settings.</span>
<span class="sd">        parent : PreparedGroup, optional</span>
<span class="sd">            The parent group.</span>
<span class="sd">        cache : DataCache, optional</span>
<span class="sd">            The data cache instance, if available.  If unspecified, a new data</span>
<span class="sd">            cache will be instantiated.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        PreparedPVConfiguration</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">PVConfiguration</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected configuration type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cache</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cache</span> <span class="o">=</span> <span class="n">DataCache</span><span class="p">()</span>

        <span class="n">prepared_comparisons</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">prepare_failures</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">shared</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">shared</span> <span class="ow">or</span> <span class="p">[]</span>

        <span class="n">prepared</span> <span class="o">=</span> <span class="n">PreparedPVConfiguration</span><span class="p">(</span>
            <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
            <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
            <span class="n">comparisons</span><span class="o">=</span><span class="n">prepared_comparisons</span><span class="p">,</span>
            <span class="n">prepare_failures</span><span class="o">=</span><span class="n">prepare_failures</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">pvname</span><span class="p">,</span> <span class="n">comparisons</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">by_pv</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">comparison</span> <span class="ow">in</span> <span class="n">comparisons</span> <span class="o">+</span> <span class="n">shared</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">prepared_comparisons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">PreparedSignalComparison</span><span class="o">.</span><span class="n">from_pvname</span><span class="p">(</span>
                            <span class="n">pvname</span><span class="o">=</span><span class="n">pvname</span><span class="p">,</span>
                            <span class="n">comparison</span><span class="o">=</span><span class="n">comparison</span><span class="p">,</span>
                            <span class="n">parent</span><span class="o">=</span><span class="n">prepared</span><span class="p">,</span>
                            <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                    <span class="n">prepare_failures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">prepared</span></div>
</div>



<div class="viewcode-block" id="PreparedToolConfiguration">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedToolConfiguration.html#atef.config.PreparedToolConfiguration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">PreparedToolConfiguration</span><span class="p">(</span><span class="n">PreparedConfiguration</span><span class="p">):</span>
    <span class="c1">#: The configuration settings.</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">ToolConfiguration</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">ToolConfiguration</span><span class="p">)</span>
    <span class="c1">#: The comparisons to be run on the given devices.</span>
    <span class="n">comparisons</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PreparedSignalComparison</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="c1">#: The comparisons that failed to be prepared.</span>
    <span class="n">prepare_failures</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PreparedComparisonException</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

<div class="viewcode-block" id="PreparedToolConfiguration.from_tool">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedToolConfiguration.html#atef.config.PreparedToolConfiguration.from_tool">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_tool</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">tool</span><span class="p">:</span> <span class="n">tools</span><span class="o">.</span><span class="n">Tool</span><span class="p">,</span>
        <span class="n">by_attr</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Comparison</span><span class="p">]],</span>
        <span class="n">shared</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Comparison</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PreparedGroup</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cache</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataCache</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PreparedToolConfiguration</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare a Tool for running tests without an associated configuration.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tool : tools.Tool</span>
<span class="sd">            The tool instance.</span>
<span class="sd">        by_attr : Dict[str, List[Comparison]]</span>
<span class="sd">            A dictionary of tool result attributes to comparisons.</span>
<span class="sd">        shared : List[Comparison], optional</span>
<span class="sd">            A list of comparisons to run on every key of the ``by_attr``</span>
<span class="sd">            dictionary.</span>
<span class="sd">        parent : PreparedGroup, optional</span>
<span class="sd">            The parent group, if available.</span>
<span class="sd">        cache : DataCache, optional</span>
<span class="sd">            The data cache instance, if available.  If unspecified, a new data</span>
<span class="sd">            cache will be instantiated.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        PreparedToolConfiguration</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">config</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span>
            <span class="n">ToolConfiguration</span><span class="p">(</span>
                <span class="n">tool</span><span class="o">=</span><span class="n">tool</span><span class="p">,</span>
                <span class="n">by_attr</span><span class="o">=</span><span class="n">by_attr</span><span class="p">,</span>
                <span class="n">shared</span><span class="o">=</span><span class="n">shared</span> <span class="ow">or</span> <span class="p">[],</span>
            <span class="p">),</span>
            <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">PreparedToolConfiguration</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span></div>


<div class="viewcode-block" id="PreparedToolConfiguration.from_config">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedToolConfiguration.html#atef.config.PreparedToolConfiguration.from_config">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_config</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">config</span><span class="p">:</span> <span class="n">ToolConfiguration</span><span class="p">,</span>
        <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PreparedGroup</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cache</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataCache</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PreparedToolConfiguration</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare a ToolConfiguration for running.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        config : ToolConfiguration</span>
<span class="sd">            The tool configuration instance.</span>
<span class="sd">        parent : PreparedGroup, optional</span>
<span class="sd">            The parent group, if available.</span>
<span class="sd">        cache : DataCache, optional</span>
<span class="sd">            The data cache instance, if available.  If unspecified, a new data</span>
<span class="sd">            cache will be instantiated.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        PreparedToolConfiguration</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">ToolConfiguration</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected configuration type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cache</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cache</span> <span class="o">=</span> <span class="n">DataCache</span><span class="p">()</span>

        <span class="n">prepared_comparisons</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">prepare_failures</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">shared</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">shared</span> <span class="ow">or</span> <span class="p">[]</span>

        <span class="n">prepared</span> <span class="o">=</span> <span class="n">PreparedToolConfiguration</span><span class="p">(</span>
            <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
            <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
            <span class="n">comparisons</span><span class="o">=</span><span class="n">prepared_comparisons</span><span class="p">,</span>
            <span class="n">prepare_failures</span><span class="o">=</span><span class="n">prepare_failures</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">result_key</span><span class="p">,</span> <span class="n">comparisons</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">by_attr</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">comparison</span> <span class="ow">in</span> <span class="n">comparisons</span> <span class="o">+</span> <span class="n">shared</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">prepared_comparisons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">PreparedToolComparison</span><span class="o">.</span><span class="n">from_tool</span><span class="p">(</span>
                            <span class="n">tool</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">tool</span><span class="p">,</span>
                            <span class="n">result_key</span><span class="o">=</span><span class="n">result_key</span><span class="p">,</span>
                            <span class="n">comparison</span><span class="o">=</span><span class="n">comparison</span><span class="p">,</span>
                            <span class="n">parent</span><span class="o">=</span><span class="n">prepared</span><span class="p">,</span>
                            <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                    <span class="n">prepare_failures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">prepared</span></div>
</div>



<div class="viewcode-block" id="PreparedTemplateConfiguration">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedTemplateConfiguration.html#atef.config.PreparedTemplateConfiguration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">PreparedTemplateConfiguration</span><span class="p">(</span><span class="n">PreparedConfiguration</span><span class="p">):</span>
    <span class="c1"># configuration origin</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">TemplateConfiguration</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">TemplateConfiguration</span><span class="p">)</span>
    <span class="c1"># prepared file with edits applied</span>
    <span class="n">file</span><span class="p">:</span> <span class="n">PreparedFile</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">PreparedFile</span><span class="p">)</span>

<div class="viewcode-block" id="PreparedTemplateConfiguration.from_config">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedTemplateConfiguration.html#atef.config.PreparedTemplateConfiguration.from_config">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_config</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">config</span><span class="p">:</span> <span class="n">TemplateConfiguration</span><span class="p">,</span>
        <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PreparedGroup</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">happi</span><span class="o">.</span><span class="n">Client</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cache</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataCache</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PreparedTemplateConfiguration</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepares a TemplateConfiguration for running.  Preparation fails if the</span>
<span class="sd">        edited file cannot itself be prepared</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        config : TemplateConfiguration</span>
<span class="sd">            the configuration to be prepared</span>
<span class="sd">        parent : PreparedGroup, optional</span>
<span class="sd">            The parent group, if available.</span>
<span class="sd">        client : happi.Client, optional</span>
<span class="sd">            A happi Client instance.</span>
<span class="sd">        cache : DataCache, optional</span>
<span class="sd">            The data cache instance, if available.  If unspecified, a new data</span>
<span class="sd">            cache will be instantiated.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        PreparedTemplateConfiguration</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cache</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cache</span> <span class="o">=</span> <span class="n">DataCache</span><span class="p">()</span>

        <span class="c1"># load file</span>
        <span class="n">config_file</span> <span class="o">=</span> <span class="n">ConfigurationFile</span><span class="o">.</span><span class="n">from_filename</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>

        <span class="c1"># convert and apply edits</span>
        <span class="n">edits</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">to_action</span><span class="p">()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">edits</span><span class="p">]</span>
        <span class="n">edit_results</span> <span class="o">=</span> <span class="p">[</span><span class="n">edit</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">config_file</span><span class="p">)</span> <span class="k">for</span> <span class="n">edit</span> <span class="ow">in</span> <span class="n">edits</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">edit_results</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">FailedConfiguration</span><span class="p">(</span>
                <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
                <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
                <span class="n">exception</span><span class="o">=</span><span class="n">PreparationError</span><span class="p">,</span>
                <span class="n">result</span><span class="o">=</span><span class="n">Result</span><span class="p">(</span>
                    <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">internal_error</span><span class="p">,</span>
                    <span class="n">reason</span><span class="o">=</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;Failed to prepare templated config: (</span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">) &#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;Could not apply all edits.&#39;</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># verify edited file</span>
        <span class="n">success</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">config_file</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">FailedConfiguration</span><span class="p">(</span>
                <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
                <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
                <span class="n">exception</span><span class="o">=</span><span class="n">PreparationError</span><span class="p">,</span>
                <span class="n">result</span><span class="o">=</span><span class="n">Result</span><span class="p">(</span>
                    <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">internal_error</span><span class="p">,</span>
                    <span class="n">reason</span><span class="o">=</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;Failed to prepare templated config: (</span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">) &#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;Configuration not valid when edits were applied. </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># prepare file</span>
        <span class="n">prep_file</span> <span class="o">=</span> <span class="n">PreparedFile</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">config_file</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span>
                                             <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">)</span>

        <span class="n">prepared</span> <span class="o">=</span> <span class="n">PreparedTemplateConfiguration</span><span class="p">(</span>
            <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
            <span class="n">file</span><span class="o">=</span><span class="n">prep_file</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
            <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">prepared</span></div>


<div class="viewcode-block" id="PreparedTemplateConfiguration.compare">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedTemplateConfiguration.html#atef.config.PreparedTemplateConfiguration.compare">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run the edited checkout and return the combined result&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">compare</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">combined_result</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">result</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">result</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Re-compute combined result and return it.  Override standard since this</span>
<span class="sd">        configuration has no comparisons</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">combined_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">result</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">combined_result</span></div>



<div class="viewcode-block" id="PreparedComparison">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedComparison.html#atef.config.PreparedComparison">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">PreparedComparison</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A unified representation of comparisons for device signals and standalone PVs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#: The data cache to use for the preparation step.</span>
    <span class="n">cache</span><span class="p">:</span> <span class="n">DataCache</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1">#: The identifier used for the comparison.</span>
    <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="c1">#: The comparison itself.</span>
    <span class="n">comparison</span><span class="p">:</span> <span class="n">Comparison</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">Comparison</span><span class="p">)</span>
    <span class="c1">#: The name of the associated configuration.</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1">#: The hierarhical parent of this comparison.</span>
    <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PreparedGroup</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1">#: The last result of the comparison, if run.</span>
    <span class="n">result</span><span class="p">:</span> <span class="n">Result</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">incomplete_result</span><span class="p">)</span>

<div class="viewcode-block" id="PreparedComparison.get_data_async">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedComparison.html#atef.config.PreparedComparison.get_data_async">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_data_async</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the data according to the comparison&#39;s configuration.</span>

<span class="sd">        To be implemented in subclass.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        data : Any</span>
<span class="sd">            The acquired data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>


    <span class="k">async</span> <span class="k">def</span> <span class="nf">_compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run the comparison.</span>

<span class="sd">        To be implemented in subclass.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

<div class="viewcode-block" id="PreparedComparison.compare">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedComparison.html#atef.config.PreparedComparison.compare">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run the comparison and return the Result.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Result</span>
<span class="sd">            The result of the comparison.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comparison</span><span class="p">,</span> <span class="s1">&#39;prepare&#39;</span><span class="p">):</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">comparison</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TimeoutError</span><span class="p">,</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">,</span> <span class="n">ConnectionTimeoutError</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span>
                <span class="n">severity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comparison</span><span class="o">.</span><span class="n">if_disconnected</span><span class="p">,</span>
                <span class="n">reason</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Unable to read dynamic value for the comparison: &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">result</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span>
                <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">internal_error</span><span class="p">,</span>
                <span class="n">reason</span><span class="o">=</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Reading dynamic value for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="si">!r}</span><span class="s2"> comparison &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">comparison</span><span class="si">}</span><span class="s2"> raised </span><span class="si">{</span><span class="n">ex</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">ex</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">result</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_async</span><span class="p">()</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TimeoutError</span><span class="p">,</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">,</span> <span class="n">ConnectionTimeoutError</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span>
                <span class="n">severity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comparison</span><span class="o">.</span><span class="n">if_disconnected</span><span class="p">,</span>
                <span class="n">reason</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Unable to retrieve data for comparison: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">result</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span>
                <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">internal_error</span><span class="p">,</span>
                <span class="n">reason</span><span class="o">=</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Getting data for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="si">!r}</span><span class="s2"> comparison &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">comparison</span><span class="si">}</span><span class="s2"> raised </span><span class="si">{</span><span class="n">ex</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">ex</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">result</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span>
                <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">internal_error</span><span class="p">,</span>
                <span class="n">reason</span><span class="o">=</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Failed to run </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="si">!r}</span><span class="s2"> comparison &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">comparison</span><span class="si">}</span><span class="s2"> raised </span><span class="si">{</span><span class="n">ex</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">ex</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="p">),</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">result</span></div>
</div>



<div class="viewcode-block" id="PreparedSignalComparison">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedSignalComparison.html#atef.config.PreparedSignalComparison">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">PreparedSignalComparison</span><span class="p">(</span><span class="n">PreparedComparison</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A unified representation of comparisons for device signals and standalone</span>
<span class="sd">    PVs.</span>

<span class="sd">    Each PreparedSignalComparison has a single leaf in the configuration tree,</span>
<span class="sd">    comprised of:</span>
<span class="sd">    * A configuration</span>
<span class="sd">    * The signal specification.  This is comprised of the configuration and</span>
<span class="sd">        &quot;IdentifierAndComparison&quot;</span>
<span class="sd">        - DeviceConfiguration: Device and attribute (the &quot;identifier&quot;)</span>
<span class="sd">        - PVConfiguration: PV name (the &quot;identifier&quot;)</span>
<span class="sd">    * A comparison to run</span>
<span class="sd">        - Including data reduction settings</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#: The hierarhical parent of this comparison.</span>
    <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span><span class="n">PreparedDeviceConfiguration</span><span class="p">,</span> <span class="n">PreparedPVConfiguration</span><span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1">#: The device the comparison applies to, if applicable.</span>
    <span class="n">device</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ophyd</span><span class="o">.</span><span class="n">Device</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1">#: The signal the comparison is to be run on.</span>
    <span class="n">signal</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ophyd</span><span class="o">.</span><span class="n">Signal</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1">#: The value from the signal the comparison is to be run on.</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="PreparedSignalComparison.get_data_async">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedSignalComparison.html#atef.config.PreparedSignalComparison.get_data_async">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_data_async</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the provided signal&#39;s data from the cache according to the</span>
<span class="sd">        reduction configuration.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        data : Any</span>
<span class="sd">            The acquired data.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        TimeoutError</span>
<span class="sd">            If unable to connect or retrieve data from the signal.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">signal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signal</span>
        <span class="k">if</span> <span class="n">signal</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Signal instance unset&quot;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">get_signal_data</span><span class="p">(</span>
            <span class="n">signal</span><span class="p">,</span>
            <span class="n">reduce_period</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comparison</span><span class="o">.</span><span class="n">reduce_period</span><span class="p">,</span>
            <span class="n">reduce_method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comparison</span><span class="o">.</span><span class="n">reduce_method</span><span class="p">,</span>
            <span class="n">string</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comparison</span><span class="o">.</span><span class="n">string</span> <span class="ow">or</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">return</span> <span class="n">data</span></div>


    <span class="k">async</span> <span class="k">def</span> <span class="nf">_compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run the comparison with the already-acquired data in ``self.data``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># &#39;None&#39; is likely incompatible with our comparisons and should</span>
            <span class="c1"># be raised for separately</span>
            <span class="k">return</span> <span class="n">Result</span><span class="p">(</span>
                <span class="n">severity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comparison</span><span class="o">.</span><span class="n">if_disconnected</span><span class="p">,</span>
                <span class="n">reason</span><span class="o">=</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;No data available for signal </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="si">!r}</span><span class="s2"> in &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;comparison </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">comparison</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">),</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">comparison</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">identifier</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span>
        <span class="p">)</span>

<div class="viewcode-block" id="PreparedSignalComparison.from_device">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedSignalComparison.html#atef.config.PreparedSignalComparison.from_device">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_device</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">device</span><span class="p">:</span> <span class="n">ophyd</span><span class="o">.</span><span class="n">Device</span><span class="p">,</span>
        <span class="n">attr</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">comparison</span><span class="p">:</span> <span class="n">Comparison</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PreparedDeviceConfiguration</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cache</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataCache</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PreparedSignalComparison</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create one PreparedComparison from a device, attribute, and comparison.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        device : ophyd.Device</span>
<span class="sd">            The ophyd Device.</span>
<span class="sd">        attr : str</span>
<span class="sd">            The attribute name of the component.  May be in dotted notation.</span>
<span class="sd">        comparison : Comparison</span>
<span class="sd">            The comparison instance to run on the PV.</span>
<span class="sd">        name : str, optional</span>
<span class="sd">            The name of this comparison.</span>
<span class="sd">        parent : PreparedPVConfiguration, optional</span>
<span class="sd">            The parent configuration, if available.</span>
<span class="sd">        cache : DataCache, optional</span>
<span class="sd">            The data cache instance, if available.  If unspecified, a new data</span>
<span class="sd">            cache will be instantiated.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        PreparedSignalComparison</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">full_attr</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">device</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">attr</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Checking </span><span class="si">%s</span><span class="s2"> with comparison </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">full_attr</span><span class="p">,</span> <span class="n">comparison</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cache</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cache</span> <span class="o">=</span> <span class="n">DataCache</span><span class="p">()</span>

        <span class="n">signal</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">signal</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Attribute </span><span class="si">{</span><span class="n">full_attr</span><span class="si">}</span><span class="s2"> does not exist on class &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
            <span class="n">identifier</span><span class="o">=</span><span class="n">full_attr</span><span class="p">,</span>
            <span class="n">comparison</span><span class="o">=</span><span class="n">comparison</span><span class="p">,</span>
            <span class="n">signal</span><span class="o">=</span><span class="n">signal</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
            <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="PreparedSignalComparison.from_pvname">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedSignalComparison.html#atef.config.PreparedSignalComparison.from_pvname">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_pvname</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">pvname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">comparison</span><span class="p">:</span> <span class="n">Comparison</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PreparedPVConfiguration</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cache</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataCache</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PreparedSignalComparison</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create one PreparedComparison from a PV name and comparison.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pvname : str</span>
<span class="sd">            The PV name.</span>
<span class="sd">        comparison : Comparison</span>
<span class="sd">            The comparison instance to run on the PV.</span>
<span class="sd">        name : str, optional</span>
<span class="sd">            The name of this comparison.</span>
<span class="sd">        parent : PreparedPVConfiguration, optional</span>
<span class="sd">            The parent configuration, if available.</span>
<span class="sd">        cache : DataCache, optional</span>
<span class="sd">            The data cache instance, if available.  If unspecified, a new data</span>
<span class="sd">            cache will be instantiated.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        PreparedSignalComparison</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cache</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cache</span> <span class="o">=</span> <span class="n">DataCache</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">identifier</span><span class="o">=</span><span class="n">pvname</span><span class="p">,</span>
            <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">signal</span><span class="o">=</span><span class="n">cache</span><span class="o">.</span><span class="n">signals</span><span class="p">[</span><span class="n">pvname</span><span class="p">],</span>
            <span class="n">comparison</span><span class="o">=</span><span class="n">comparison</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="PreparedSignalComparison.from_signal">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedSignalComparison.html#atef.config.PreparedSignalComparison.from_signal">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_signal</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">signal</span><span class="p">:</span> <span class="n">ophyd</span><span class="o">.</span><span class="n">Signal</span><span class="p">,</span>
        <span class="n">comparison</span><span class="p">:</span> <span class="n">Comparison</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PreparedPVConfiguration</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cache</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataCache</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PreparedSignalComparison</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a PreparedSignalComparison from a signal directly</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        signal : ophyd.Signal</span>
<span class="sd">            The signal to compare</span>
<span class="sd">        comparison : Comparison</span>
<span class="sd">            The comparison instance to run on the PV.</span>
<span class="sd">        name : str, optional</span>
<span class="sd">            The name of this comparison.</span>
<span class="sd">        parent : PreparedPVConfiguration, optional</span>
<span class="sd">            The parent configuration, if available.</span>
<span class="sd">        cache : DataCache, optional</span>
<span class="sd">            The data cache instance, if available.  If unspecified, a new data</span>
<span class="sd">            cache will be instantiated.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        PreparedSignalComparison</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cache</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cache</span> <span class="o">=</span> <span class="n">DataCache</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">identifier</span><span class="o">=</span><span class="n">signal</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">signal</span><span class="o">=</span><span class="n">signal</span><span class="p">,</span>
            <span class="n">comparison</span><span class="o">=</span><span class="n">comparison</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="PreparedToolComparison">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedToolComparison.html#atef.config.PreparedToolComparison">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">PreparedToolComparison</span><span class="p">(</span><span class="n">PreparedComparison</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A unified representation of comparisons for device signals and standalone PVs.</span>

<span class="sd">    Each PreparedToolComparison has a single leaf in the configuration tree,</span>
<span class="sd">    comprised of:</span>

<span class="sd">    * A configuration</span>
<span class="sd">    * The tool configuration (i.e., a :class:`tools.Tool` instance)</span>
<span class="sd">    * Identifiers to compare are dependent on the tool type</span>
<span class="sd">    * A comparison to run</span>
<span class="sd">        - For example, a :class:`atef.tools.Ping` has keys described in</span>
<span class="sd">          :class:`~atef.tools.PingResult`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#: The device the comparison applies to, if applicable.</span>
    <span class="n">tool</span><span class="p">:</span> <span class="n">tools</span><span class="o">.</span><span class="n">Tool</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">tools</span><span class="o">.</span><span class="n">Ping</span><span class="p">(</span><span class="n">hosts</span><span class="o">=</span><span class="p">[]))</span>

<div class="viewcode-block" id="PreparedToolComparison.get_data_async">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedToolComparison.html#atef.config.PreparedToolComparison.get_data_async">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_data_async</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the provided tool&#39;s result data from the cache.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        data : Any</span>
<span class="sd">            The acquired data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">get_tool_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tool</span><span class="p">)</span></div>


    <span class="k">async</span> <span class="k">def</span> <span class="nf">_compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run the prepared comparison.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Result</span>
<span class="sd">            The result of the comparison.  This is also set in ``self.result``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">get_result_value_by_key</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Result</span><span class="p">(</span>
                <span class="n">severity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comparison</span><span class="o">.</span><span class="n">severity_on_failure</span><span class="p">,</span>
                <span class="n">reason</span><span class="o">=</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Provided key is invalid for tool result </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tool</span><span class="si">}</span><span class="s2"> &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="si">!r}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">ex</span><span class="si">}</span><span class="s2"> &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;(in comparison </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">comparison</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">comparison</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span>
            <span class="n">value</span><span class="p">,</span>
            <span class="n">identifier</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span>
        <span class="p">)</span>

<div class="viewcode-block" id="PreparedToolComparison.from_tool">
<a class="viewcode-back" href="../../generated/generated/atef.config.PreparedToolComparison.html#atef.config.PreparedToolComparison.from_tool">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_tool</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">tool</span><span class="p">:</span> <span class="n">tools</span><span class="o">.</span><span class="n">Tool</span><span class="p">,</span>
        <span class="n">result_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">comparison</span><span class="p">:</span> <span class="n">Comparison</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PreparedToolConfiguration</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cache</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataCache</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PreparedToolComparison</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare a tool-based comparison for execution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tool : Tool</span>
<span class="sd">            The tool to run.</span>
<span class="sd">        result_key : str</span>
<span class="sd">            The key from the result dictionary to check after running the tool.</span>
<span class="sd">        comparison : Comparison</span>
<span class="sd">            The comparison to perform on the tool&#39;s results (looking at the</span>
<span class="sd">            specific result_key).</span>
<span class="sd">        name : str, optional</span>
<span class="sd">            The name of the comparison.</span>
<span class="sd">        cache : DataCache, optional</span>
<span class="sd">            The data cache instance, if available.  If unspecified, a new data</span>
<span class="sd">            cache will be instantiated.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        PreparedToolComparison</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cache</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cache</span> <span class="o">=</span> <span class="n">DataCache</span><span class="p">()</span>
        <span class="n">tool</span><span class="o">.</span><span class="n">check_result_key</span><span class="p">(</span><span class="n">result_key</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">tool</span><span class="o">=</span><span class="n">tool</span><span class="p">,</span>
            <span class="n">comparison</span><span class="o">=</span><span class="n">comparison</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">identifier</span><span class="o">=</span><span class="n">result_key</span><span class="p">,</span>
            <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
        <span class="p">)</span></div>
</div>



<span class="n">AnyPreparedConfiguration</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">PreparedDeviceConfiguration</span><span class="p">,</span>
    <span class="n">PreparedGroup</span><span class="p">,</span>
    <span class="n">PreparedPVConfiguration</span><span class="p">,</span>
    <span class="n">PreparedToolConfiguration</span><span class="p">,</span>
    <span class="n">PreparedTemplateConfiguration</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">_class_to_prepared</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">type</span><span class="p">,</span> <span class="nb">type</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">ConfigurationFile</span><span class="p">:</span> <span class="n">PreparedFile</span><span class="p">,</span>
    <span class="n">ConfigurationGroup</span><span class="p">:</span> <span class="n">PreparedGroup</span><span class="p">,</span>
    <span class="n">ToolConfiguration</span><span class="p">:</span> <span class="n">PreparedToolConfiguration</span><span class="p">,</span>
    <span class="n">DeviceConfiguration</span><span class="p">:</span> <span class="n">PreparedDeviceConfiguration</span><span class="p">,</span>
    <span class="n">PVConfiguration</span><span class="p">:</span> <span class="n">PreparedPVConfiguration</span><span class="p">,</span>
    <span class="n">TemplateConfiguration</span><span class="p">:</span> <span class="n">PreparedTemplateConfiguration</span><span class="p">,</span>
<span class="p">}</span>


<div class="viewcode-block" id="get_result_from_comparison">
<a class="viewcode-back" href="../../generated/generated/atef.config.get_result_from_comparison.html#atef.config.get_result_from_comparison">[docs]</a>
<span class="k">def</span> <span class="nf">get_result_from_comparison</span><span class="p">(</span>
    <span class="n">item</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">PreparedComparison</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">PreparedComparison</span><span class="p">],</span> <span class="n">Result</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a Result, if available, from the provided arguments.</span>

<span class="sd">    In the case of an exception (or None/internal error), create one.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    item : Union[PreparedComparison, Exception, None]</span>
<span class="sd">        The item to grab a result from.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    PreparedComparison or None :</span>
<span class="sd">        The prepared comparison, if available</span>
<span class="sd">    Result :</span>
<span class="sd">        The result instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">Result</span><span class="p">(</span>
            <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">internal_error</span><span class="p">,</span>
            <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;no result available (comparison not run?)&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">):</span>
        <span class="c1"># An error that was transformed into a Result with a severity</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">Result</span><span class="o">.</span><span class="n">from_exception</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">item</span><span class="p">,</span> <span class="n">Result</span><span class="p">(</span>
            <span class="n">severity</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">internal_error</span><span class="p">,</span>
            <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;no result available (comparison not run?)&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">item</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">result</span></div>



<div class="viewcode-block" id="run_passive_step">
<a class="viewcode-back" href="../../generated/generated/atef.config.run_passive_step.html#atef.config.run_passive_step">[docs]</a>
<span class="k">async</span> <span class="k">def</span> <span class="nf">run_passive_step</span><span class="p">(</span>
    <span class="n">config</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">PreparedComparison</span><span class="p">,</span> <span class="n">PreparedConfiguration</span><span class="p">,</span> <span class="n">PreparedFile</span><span class="p">]</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Runs a given check and returns the result.&quot;&quot;&quot;</span>
    <span class="c1"># Warn if will run all subcomparisons?</span>
    <span class="n">cache_fill_tasks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cache_fill_tasks</span> <span class="o">=</span> <span class="k">await</span> <span class="n">config</span><span class="o">.</span><span class="n">fill_cache</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">CancelledError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Tests interrupted; no results available.&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">config</span><span class="o">.</span><span class="n">compare</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">CancelledError</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">cache_fill_tasks</span> <span class="ow">or</span> <span class="p">[]:</span>
            <span class="n">task</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">result</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, SLAC National Accelerator Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>